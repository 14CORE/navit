machine:
  pre:
dependencies:
  pre:
    - mkdir -p ~/assets/binmaps/
    - find  ~/assets/
    - sudo apt-get update
#    - sudo apt-get upgrade
    - sudo apt-get install cmake 
#    - sudo apt-get install zlib1g-dev
    - sudo apt-get install libpng12-dev 
    - sudo apt-get install libgtk2.0-dev 
    - sudo apt-get install librsvg2-bin 
    - sudo apt-get install g++
    - sudo apt-get install libdbus-glib-1-dev
    - sudo apt-get install libfreetype6-dev
    - bash ~/navit/build.sh
# windows build
    - sudo apt-get install -y mingw32 libsaxonb-java mingw32-binutils mingw32-runtime
    - sudo apt-get install -y make default-jdk gettext nsis
# for sys/select.h
    - sudo apt-get install -y libc6-dev
    - mkdir win32
    - cmake -Dbinding/python:BOOL=FALSE -DCMAKE_TOOLCHAIN_FILE=../Toolchain/mingw32.cmake ../ && make:
        pwd: win32
    - make package && mv *.exe $CIRCLE_ARTIFACTS/:
        pwd: win32
  cache_directories:
    - "~/assets/"
test:
  post:
    - sed -i -e 's@name="Local GPS" profilename="car" enabled="yes" active="1"@name="Local GPS" profilename="car" enabled="no" active="0"@' navit.xml:
        pwd: bin/navit/
    - sed -i -e 's@name="Demo" profilename="car" enabled="no" active="yes"@name="Demo" profilename="car" enabled="yes" active="yes" follow="1" refresh="1"@' navit.xml:
        pwd: bin/navit/
    - sed -i -e 's@type="internal" enabled@type="internal" fullscreen="1" font_size="350" enabled@' navit.xml:
        pwd: bin/navit/
    - sed -i -e 's@libbinding_dbus.so" active="no"@libbinding_dbus.so" active="yes"@' navit.xml:
        pwd: bin/navit/
    - ./navit:
        pwd: bin/navit/
        background: true
    - sleep 5
    - import -window root $CIRCLE_ARTIFACTS/default.png
    - bash test_route.sh $CIRCLE_ARTIFACTS
    - dbus-send  --print-reply --session --dest=org.navit_project.navit /org/navit_project/navit/default_navit org.navit_project.navit.navit.quit
